<div
  class="container mt-4 dashboard-container"
  role="main"
  aria-labelledby="titulo-dashboard"
>
  <app-page-header
    id="titulo-dashboard"
    title="Dashboard de Vendas"
  ></app-page-header>

  <div class="row">
    <div class="col-12">
      <div class="upload-container" aria-label="Área de envio de arquivo CSV">
        <app-upload
          (dadosCarregados)="aoReceberDados($event)"
          (erroUpload)="aoReceberErro($event)"
          aria-label="Componente de upload de arquivo CSV"
        ></app-upload>
      </div>
    </div>
  </div>

  <div
    class="row"
    *ngIf="vendas.length > 0"
    aria-live="polite"
    aria-relevant="additions"
  >
    <div class="col-lg-7 mb-4">
      <div
        class="card p-3 shadow-sm border-0 mb-4"
        role="region"
        aria-labelledby="total-geral"
      >
        <p class="label" id="total-geral">Total Geral</p>
        <h3 class="value success" aria-live="polite">
          {{ totalGeral | currencyBr }}
        </h3>
      </div>

      <div
        class="table-section p-0 overflow-hidden shadow-sm"
        role="region"
        aria-labelledby="titulo-tabela"
      >
        <p id="titulo-tabela" class="sr-only">Tabela de vendas por produto</p>

        <p-table
          [value]="vendas"
          [paginator]="true"
          [rows]="5"
          [globalFilterFields]="['produto']"
          #dt
          styleClass="p-datatable-sm p-datatable-striped"
          aria-label="Tabela de vendas por produto"
        >
          <ng-template pTemplate="caption">
            <div class="search-bar border-0">
              <span class="p-input-icon-left w-100">
                <i class="pi pi-search" aria-hidden="true"></i>
                <input
                  type="text"
                  pInputText
                  placeholder="Buscar produto"
                  class="search-input"
                  aria-label="Buscar produto pelo nome"
                  (input)="
                    dt.filterGlobal($any($event.target).value, 'contains')
                  "
                />
              </span>
            </div>
          </ng-template>

          <ng-template pTemplate="header">
            <tr>
              <th scope="col" pSortableColumn="produto">
                Produto <p-sortIcon field="produto"></p-sortIcon>
              </th>
              <th scope="col" pSortableColumn="quantidadeTotal">
                Quantidade <p-sortIcon field="quantidadeTotal"></p-sortIcon>
              </th>
              <th scope="col" pSortableColumn="valorTotal">
                Valor <p-sortIcon field="valorTotal"></p-sortIcon>
              </th>
              <th scope="col">Ações</th>
            </tr>
          </ng-template>

          <ng-template pTemplate="body" let-venda>
            <tr>
              <td>{{ venda.produto }}</td>
              <td>{{ venda.quantidadeTotal }}</td>
              <td class="font-weight-bold">
                {{ venda.valorTotal | currencyBr }}
              </td>
              <td>
                <button class="btn-details" (click)="abrirDetalhes(venda)">
                  Detalhes
                </button>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>

    <div class="col-lg-5 mb-4 d-flex flex-column h-100">
      <div class="card p-3 shadow-sm border-0 mb-4 flex-shrink-0">
        <p class="label">Produto Mais Vendido</p>
        <h3 class="value">{{ produtoMaisVendido }}</h3>
      </div>
      <div
        class="chart-card shadow-sm border-0 p-3 flex-grow-1 d-flex flex-column"
      >
        <h3 class="mb-4" style="font-size: 1.1rem">Vendas por Produto</h3>

        <div class="chart-wrapper w-100 flex-grow-1" aria-hidden="true">
          <p-chart
            type="bar"
            [data]="chartData"
            [options]="chartOptions"
            height="100%"
            width="100%"
          ></p-chart>
        </div>

        <div class="visually-hidden">
          <table
            summary="Tabela detalhada representando os dados do gráfico de barras de vendas por produto"
          >
            <caption>
              Dados de Vendas por Produto
            </caption>

            <thead>
              <tr>
                <th scope="col">Produto</th>
                <th scope="col">Quantidade Vendida</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of vendas">
                <td>{{ item.produto }}</td>
                <td>{{ item.quantidadeTotal }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
